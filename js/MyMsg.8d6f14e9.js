(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["MyMsg"],{"172a":function(t,e,s){},"3c00":function(t,e,s){"use strict";var i=s("172a"),a=s.n(i);a.a},d1f7:function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"my-msg-container"},[i("TheHeader",{attrs:{"left-arrow":"",title:t.$t("myMsg.myMsgInfo"),leftClick:t.goBack,isFixedTop:!0},on:{"click-right":t.toggleEdit},scopedSlots:t._u([{key:"right",fn:function(){return[i("img",{directives:[{name:"show",rawName:"v-show",value:!t.isEdit,expression:"!isEdit"}],staticClass:"edit-icon",attrs:{src:s("fe6a"),alt:""}}),i("BaseButton",{directives:[{name:"show",rawName:"v-show",value:t.isEdit,expression:"isEdit"}],staticClass:"header-action-btn"},[i("span",{staticClass:"header-btn-text"},[t._v(t._s(t.$t("myMsg.QuitEditing")))])])]},proxy:!0}])}),i("div",{staticClass:"search-filed"},[i("BaseCell",{scopedSlots:t._u([{key:"left",fn:function(){return[t._v(t._s(t.$t("myMsg.Status")))]},proxy:!0},{key:"middle",fn:function(){return[i("div",{staticClass:"status-select"},[i("BaseSelector",{attrs:{columns:t.statusTypes,valueKey:"value",presentKey:"name",value:t.activeStatus},on:{confirm:t.onConfirm}})],1)]},proxy:!0}])})],1),i("div",{staticClass:"message-list-box"},[i("van-pull-refresh",{on:{refresh:t.init},model:{value:t.isLoading,callback:function(e){t.isLoading=e},expression:"isLoading"}},t._l(t.messageList,(function(e,s){return i("van-swipe-cell",{key:e.id,attrs:{"right-width":65}},[i("van-cell-group",[i("div",{staticClass:"msg-box-wrapper"},[i("MsgBox",{attrs:{isEdit:t.isEdit,index:s,message:e},on:{click:function(s){return t.goMsgInfo(e)},check:t.onCheck}})],1)]),i("div",{staticClass:"swipe-delete-wrapper",attrs:{slot:"right"},slot:"right"},[i("div",{staticClass:"delete-button",on:{click:function(s){return t.delMsg([e.id])}}},[i("van-icon",{staticClass:"icon",attrs:{name:"cross"}})],1)])],1)})),1)],1),i("div",{directives:[{name:"show",rawName:"v-show",value:t.isEdit,expression:"isEdit"}],staticClass:"tool-bar"},[i("LinearButton",{staticClass:"tool-btn",on:{click:t.checkAll}},[t._v(t._s(t.$t("myMsg.SelectAll")))]),i("LinearButton",{staticClass:"tool-btn",on:{click:t.deleteAll}},[t._v(t._s(t.$t("myMsg.Delete")))]),i("LinearButton",{staticClass:"tool-btn",on:{click:t.allAsReaded}},[t._v(t._s(t.$t("myMsg.AllAsRead")))])],1),i("Pagination",{key:t.paginationKey,attrs:{isShow:t.isPaginationShow,isLoading:t.isPaginationLoading},on:{click:t.pagingFn}})],1)},a=[],n=s("9ccf");function o(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),s.push.apply(s,i)}return s}function r(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?o(Object(s),!0).forEach((function(e){c(t,e,s[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):o(Object(s)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))}))}return t}function c(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}var l={name:"MyMsg",data(){return{statusTypes:[{name:()=>""+this.$t("myMsg.MyMessage"),value:null},{name:()=>""+this.$t("myMsg.UnreadMessages"),value:0},{name:()=>""+this.$t("myMsg.ReadMessages"),value:1}],activeStatus:null,isEdit:!1,isLoading:!1,messageList:[],isPaginationShow:!1,isPaginationLoading:!1,paginationKey:1}},watch:{isEdit(){this.isEdit||this.messageList.forEach(t=>{t.isChecked=!1})}},created(){this.init()},methods:{goBack(){this.isEdit?this.$cf.showConfirmCancelDialog({title:""+this.$t("myMsg.QuitEditing"),onConfirm:()=>{Object(n["goBack"])(this.$route)}}):Object(n["goBack"])(this.$route)},onConfirm(t){this.activeStatus=t.value,this.init()},init(){this.paginationKey=1,this.$api.my.myMsgList({body:{isRead:this.activeStatus,memberId:localStorage.getItem("memberId")},pageBean:{page:this.paginationKey,pageSize:15}},t=>{this.isLoading=!1,this.messageList=t.data.data.map(t=>r(r({},t),{},{isChecked:!1,content:this.formHtml(t.content)})),t.data.hasNextPage&&(this.isPaginationShow=!0)}),this.$api.my.getPerInfo({body:{}},t=>{this.userName=t.data.username})},formHtml(t){if(t){const e=new RegExp("(i?)(<img)([^>]+>)","gmi"),s=new RegExp("(i?)(<table)([^>]+>)","gmi");return t=t.replace(e,"<span>[图片]</span>"),t=t.replace(s,"<span>[表格]</span>"),t}return""},delMsg(t){this.$cf.showConfirmCancelDialog({title:this.$t("myMsg.DeleteMessage"),message:this.$t("myMsg.DeleteTheMessage"),onConfirm:()=>{this.$api.my.delMsg({body:{ids:t,memberId:localStorage.getItem("memberId"),username:this.userName}},()=>{this.init(),this.$cf.toast(this.$t("myMsg.MessageDeleted")),this.isEdit=!1})}})},goMsgInfo({id:t,messageId:e,msgType:s,isRead:i}){i?this.$router.push({path:"/myMsgInfo",query:{id:t,messageId:e,msgType:s}}):this.$api.my.UpMsgItem({body:{id:t}},()=>{this.$router.push({path:"/myMsgInfo",query:{id:t,messageId:e,msgType:s}})})},toggleEdit(){this.isEdit=!this.isEdit},onCheck(t){const e=this.messageList[t];e.isChecked=!e.isChecked},checkAll(){this.messageList.forEach(t=>{t.isChecked=!0})},deleteAll(){const t=this.messageList.filter(t=>!0===t.isChecked).map(t=>t.id);this.delMsg(t)},allAsReaded(){const t=this.messageList.map(t=>t.id);this.$api.my.changeMultiMessageStatus({body:{ids:t}},()=>{this.messageList.forEach(t=>{t.isRead=1})})},getMsgList(){this.isPaginationLoading=!0,this.paginationKey++,this.$api.my.myMsgList({body:{isRead:this.activeStatus,memberId:localStorage.getItem("memberId")},pageBean:{page:this.paginationKey,pageSize:15}},t=>{this.isPaginationLoading=!1,t.data.hasNextPage||(this.isPaginationShow=!1);const e=t.data.data.map(t=>r(r({},t),{},{isChecked:!1,content:this.formHtml(t.content)}));this.messageList=this.messageList.concat(e)})},pagingFn(){this.getMsgList()}},components:{MsgBox:()=>s.e("chunk-1248d5ec").then(s.bind(null,"f5f8")),LinearButton:()=>s.e("chunk-73bcffce").then(s.bind(null,"ec6b")),Pagination:()=>s.e("chunk-2d0c08b4").then(s.bind(null,"41de"))}},g=l,d=(s("3c00"),s("2877")),h=Object(d["a"])(g,i,a,!1,null,"01649716",null);e["default"]=h.exports},fe6a:function(t,e,s){t.exports=s.p+"img/icon-edit.2b827995.svg"}}]);